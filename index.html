document.getElementById('exerciseModal').classList.add('active');
    }

    function deleteExercise(i) {
        if (confirm('Delete this exercise?')) {
            haptic('medium');
            const day = workoutData.weeks[selectedWeek].days[selectedDay];
            day.exercises.splice(i, 1);
            saveData();
            renderExerciseList();
        }
    }

    function closeModal() {
        haptic();
        document.getElementById('exerciseModal').classList.remove('active');
    }

    document.getElementById('exerciseForm').onsubmit = function(e) {
        e.preventDefault();
        haptic('medium');
        
        const exData = {
            name: document.getElementById('exerciseName').value,
            type: document.getElementById('exerciseType').value,
            sets: parseInt(document.getElementById('exerciseSets').value),
            reps: document.getElementById('exerciseReps').value,
            tempo: document.getElementById('exerciseTempo').value,
            rest: parseInt(document.getElementById('exerciseRest').value),
            weight: null,
            targetWeight: null,
            targetReps: null,
            weightChange: 0,
            repsChange: 0,
            completed: null,
            setResults: [],
            notes: document.getElementById('exerciseNotes').value
        };
        
        const day = workoutData.weeks[selectedWeek].days[selectedDay];
        
        if (editingExerciseIndex !== null) {
            const existing = day.exercises[editingExerciseIndex];
            exData.weight = existing.weight;
            exData.targetWeight = existing.targetWeight;
            exData.targetReps = existing.targetReps;
            exData.weightChange = existing.weightChange;
            exData.repsChange = existing.repsChange;
            exData.completed = existing.completed;
            exData.setResults = existing.setResults || [];
            
            day.exercises[editingExerciseIndex] = exData;
        } else {
            day.exercises.push(exData);
        }
        
        saveData();
        closeModal();
        renderExerciseList();
    };

    document.getElementById('backBtn').onclick = function() {
        haptic();
        if (currentView === 'exercise') {
            showDayView(selectedWeek);
        } else if (currentView === 'day') {
            renderWeekView();
        }
    };

    document.getElementById('addBtn').onclick = function() {
        openAddExerciseModal();
    };

    initializeProgram();
</script>
